# Redis Configuration para Intelligent Document Search
# Configuração otimizada para filas de jobs + cache de sessões

# === PERSISTÊNCIA ===
# Salvar dados em disco para não perder jobs
# Salvar se pelo menos 1 chave mudou em 15 minutos
save 900 1
# Salvar se pelo menos 10 chaves mudaram em 5 minutos
save 300 10
# Salvar se pelo menos 10000 chaves mudaram em 1 minuto
save 60 10000

# AOF (Append Only File) para durabilidade máxima
appendonly yes
appendfilename "appendonly.aof"
# Sync a cada segundo (balanço performance/durabilidade)
appendfsync everysec

# === MEMÓRIA ===
# Política de eviction (quando memória fica cheia)
# Remove chaves menos usadas
maxmemory-policy allkeys-lru

# === REDE ===
# Bind para aceitar conexões de outros containers Docker
bind 0.0.0.0
port 6379

# Timeout para conexões inativas (30 minutos)
timeout 1800

# === LOGS ===
loglevel notice
# Log para stdout (Docker captura)
logfile ""

# === PERFORMANCE ===
# Desabilitar comandos perigosos em produção
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG ""

# TCP keepalive
tcp-keepalive 300

# === RQ ESPECÍFICO ===
# Configurações otimizadas para Redis Queue

# Aumentar timeout para jobs longos (processamento de documentos)
tcp-backlog 511

# Otimizar para workloads com muitas listas (filas RQ)
list-max-ziplist-size -2
list-compress-depth 0

# === SEGURANÇA ===
# Senha (deve ser definida via variável de ambiente em produção)
# requirepass your-secure-password-here

# === MONITORAMENTO ===
# Habilitar estatísticas
latency-monitor-threshold 100
